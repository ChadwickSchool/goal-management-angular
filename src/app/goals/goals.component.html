<h1 class="title">Current Goals</h1>
<div class="=loading-shade" *ngIf="loading">
</div>

<div style="display: inline;" [hidden]="!classes || classes.length == 0">
  <button nbButton status="primary" size="small" *ngIf="!loading" id="createGoal" [matMenuTriggerFor]="menu"><nb-icon icon="plus-outline"></nb-icon>Create Goal</button>
  <mat-menu #menu="matMenu">
    <button mat-menu-item *ngFor="let class of classes" (click)="createGoalDialog(class)">
      <mat-icon>{{class.classIcon ? class.classIcon : 'class'}}</mat-icon>
      {{class.title}}
    </button>
  </mat-menu>
</div>


<p *ngIf="dataSource.data.length == 0 && !loading" class="subtitle">No Goals Assigned Yet.</p>


<div class="main">
  <gms-spinner *ngIf="loading"></gms-spinner>
  <table mat-table [dataSource]="dataSource" class="table" *ngIf="dataSource.data.length > 0">
    <!-- Description Column -->
    <ng-container matColumnDef="description">
      <th mat-header-cell *matHeaderCellDef> description </th>
      <td mat-cell *matCellDef="let element"> {{element.description}} </td>
    </ng-container>

    <!-- Due Date Column -->
    <ng-container matColumnDef="dueDate">
      <th mat-header-cell *matHeaderCellDef> Due Date </th>

      <td mat-cell *matCellDef="let element" > {{ element.dueDate.seconds * 1000 | date}}</td>
    </ng-container>

    <!-- isCompleted Column -->
    <ng-container matColumnDef="isCompleted">
      <th mat-header-cell *matHeaderCellDef> Completed? </th>
      <td mat-cell *matCellDef="let element">
        <mat-icon aria-hidden="false" aria-label="Example done icon" *ngIf="element.isCompleted">done</mat-icon>
        <mat-icon aria-hidden="false" aria-label="Example close icon" *ngIf="!element.isCompleted && element.status != 'pending'">close</mat-icon>
        <mat-icon aria-hidden="false" aria-label="Example close icon" *ngIf="element.status == 'pending'">schedule</mat-icon>
      </td>
    </ng-container>

    <!-- isCompleted Column -->
    <ng-container matColumnDef="createdBy">
      <th mat-header-cell *matHeaderCellDef> Created By </th>
      <td mat-cell *matCellDef="let element"> {{ element.createdBy}} </td>
    </ng-container>


    <tr mat-header-row *matHeaderRowDef="goalsDisplayedColumns"></tr>
    <tr mat-row (click)="openDialog(row.goalReference, uid, row.isCompleted, row.status)" *matRowDef="let row; columns: goalsDisplayedColumns;"
    [class.green-row]="row.status == 'completed'"
    [class.yellow-row]="row.status == 'pending'"
    [class.red-row]="row.status == 'incomplete'"></tr>
  </table>


  <div class="main">
    <table [nbTreeGrid]="source">
      <tr nbTreeGridHeaderRow *nbTreeGridHeaderRowDef="allColumns"></tr>
      <tr nbTreeGridRow *nbTreeGridRowDef="let row; columns: allColumns"></tr>
  
      <ng-container [nbTreeGridColumnDef]="customColumn">
        <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>{{customColumn}}</th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row">
  
          {{row.data[customColumn]}}
  
        </td>
      </ng-container>
  
      <ng-container *ngFor="let column of defaultColumns" [nbTreeGridColumnDef]="column">
        <th nbTreeGridHeaderCell *nbTreeGridHeaderCellDef>{{column}}</th>
        <td nbTreeGridCell *nbTreeGridCellDef="let row">{{row.data[column]}}</td>
      </ng-container>
    </table>
  </div>
  

</div>
